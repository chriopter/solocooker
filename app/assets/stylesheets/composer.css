/* Composer */
.composer {
  flex: none;
  padding: var(--block-space-half) calc(var(--inline-space) + 1vw);
  
  /* Prevent overlap with sidebar toggle button on desktop */
  @media (min-width: 100ch) {
    padding-inline-end: calc(var(--inline-space) + 4em);
  }
}

.composer__input-hint,
.composer__context-btn {
  .composer:has(.composer__input:focus-within) & {
    @media (max-width: 100ch) {
      display: none;
    }
  }
}

/* Make context buttons perfectly circular */
.composer__context-btn {
  width: 2.65em;
  height: 2.65em;
  padding: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 1.3rem;
  transition: all 0.3s ease;
  overflow: hidden;
  white-space: nowrap;
  
  /* Make emoji bigger */
  span:not(.for-screen-reader) {
    font-size: 1.3em;
    display: inline-block; /* Needed for transform to work */
  }
}

/* Recycle button sections styling */
.recycle-btn {
  position: relative;
  overflow: hidden;
  transition: width 0.3s ease;
}

.recycle-sections {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 100%;
  position: relative;
}

.recycle-left {
  transition: all 0.3s ease;
  position: relative;
}

.recycle-right {
  position: absolute;
  opacity: 0;
  right: 0.5em;  /* Far right edge */
  transform: translateX(3em);
  transition: opacity 0.3s ease, transform 0.3s ease;
  pointer-events: none;
}

/* Recycle button active state - expand to 3x width */
.composer__context-btn.recycle-active {
  width: 8em; /* 3x the original 2.65em */
  /* padding: 0 1em; - old single section padding */
  background: rgba(34, 197, 94, 0.1);
  animation: pulse-green 1s infinite;
}

.recycle-active .recycle-left {
  /* Move countdown to far left edge */
  position: absolute;
  left: 0.5em;
  transform: none;
}

.recycle-active .recycle-right {
  /* Show trash icon on right */
  opacity: 1;
  transform: translateX(0);
  pointer-events: auto;
}

/* Hide/slide out search button when recycle is expanded */
.search-btn {
  transition: transform 0.3s ease, opacity 0.3s ease, margin-right 0.3s ease;
}

.composer:has(.recycle-active) .search-btn {
  transform: translateX(-3em);
  opacity: 0;
  margin-right: -2.65em; /* Collapse the space it was taking */
  pointer-events: none;
}

@keyframes pulse-green {
  0%, 100% { 
    background: rgba(34, 197, 94, 0.1);
  }
  50% { 
    background: rgba(34, 197, 94, 0.2);
  }
}

@keyframes error-shake {
  0%, 100% { transform: rotate(0deg); }
  25% { transform: rotate(-5deg); }
  75% { transform: rotate(5deg); }
}

@keyframes success-bounce {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.2); }
}

/* Attachments */
.composer__attachment-btn {
  --hover-filter: brightness(0.85);

  @media (any-hover: hover) {
    &:where(:not(:active):hover) {
      filter: var(--hover-filter);
      box-shadow: none;
    }
  }
}

/* Pending attachments */
.composer__filelist {
  --row-gap: var(--block-space-half);

  &:not(:empty) {
    padding-block-end: var(--block-space-half);
  }
}

.composer__file {
  --aspect-ratio: 5/4;
  --btn-border-radius: 1em;
  --thumbnail-size: 15ch;

  aspect-ratio: var(--aspect-ratio);
  inline-size: var(--thumbnail-size);
}

:is(img, span):is(.composer__file-thumbnail) {
  aspect-ratio: var(--aspect-ratio);
  block-size: auto;
  border-radius: var(--btn-border-radius);
  border: 1px solid var(--color-border-darker);
  inline-size: var(--thumbnail-size);
  object-fit: cover;
}

.composer__file-thumbnail--common {
  background: url(common-file-text.svg) no-repeat center;
  background-size: 55%;
}

.composer__file-caption {
  --icon-size: 1.3em;

  &::after {
    content: "";
    block-size: var(--icon-size);
    inline-size: var(--icon-size);
    background: url("remove-circle.svg") no-repeat center;
    margin-inline: 0.5em -0.5em;
    flex-shrink: 0;
  }

  @media (prefers-color-scheme: dark) {
    &::after {
      filter: invert(100%);
    }
  }
}

/* Rich text */
.composer__rich-text-btn {
  --hover-filter: brightness(0.85);

  display: none;

  @media (any-hover: hover) {
    &:where(:not(:active):hover) {
      filter: var(--hover-filter);
      box-shadow: none;
    }
  }

  img {
    inline-size: 1.7em;
  }
}

@media (min-width: 100ch) and (any-hover: hover) and (pointer: fine) {
  .composer__rich-text-btn {
    display: inline-flex;
  }

  .composer--rich-text {
    trix-toolbar {
      display: block;
    }

    trix-editor.input {
      margin-block-start: var(--block-space-half);
    }
  }

  .composer--edit trix-toolbar {
    border-block-end: 1px solid var(--color-border);
    margin-inline: -0.8em;
    padding-inline: 0.3em;
    padding-block-end: 0.5em;
  }
}

/* Typing indicator */
.typing-indicator {
  inset-block-start: var(--indicator-position, 0.15rem);
  inset-inline-start: var(--block-space);
  opacity: var(--indicator-opacity, 0);
  position: absolute;
  transition: inset-block-start 300ms ease,
              opacity 300ms ease;

  .sidebar & {
    @media (min-width: 100ch) {
      margin-inline-start: 2vw;
    }
  }

  &.typing-indicator--active {
    --indicator-position: 0.15rem;
    --indicator-opacity: 1;
  }
}

.typing-indicator__author {
  line-height: 1;
  padding-inline-start: 1.5em;

  &.spinner {
    display: none;

    .typing-indicator--active & {
      display: block;
    }
  }
}

.composer__input {
  .composer__rich-text-btn,
  label:has(input[type="file"]) {
    cursor: pointer;
  }
}
